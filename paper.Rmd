---
title: A scripted workflow for updating GIS regression mapping models using land use and other predictors of air pollution
author:  
- name: Luke Knibbs 
  affilnum: 1,2
  email: l.knibbs@uq.edu.au
  orcid: 0000-0002-0399-2370
- name: Christy Geromboux
  affilnum: 2,3  
- name: Ivan C. Hanigan
  affilnum: 2,3,4
  orcid: 0000-0002-6360-6793
affiliation:
- affilnum: 1
  affil: The University of Queensland, School of Public Health  
- affilnum: 2
  affil: Centre for Air pollution, energy and health Research (CAR)
- affilnum: 3
  affil: The University of Sydney, University Centre for Rural Health, School of Public Health
- affilnum: 4
  affil: The University of Canberra, Centre for Research and Action in Public Health
output:
  pdf_document:
    fig_caption: yes
    keep_tex: no
    number_sections: yes
    template: tex_components/manuscript.latex
  html_document: null
  word_document: null
fontsize: 11pt
header-includes:
  - \usepackage{graphicx}
capsize: normalsize
csl: tex_components/meemodified.csl
documentclass: article
classoption: a4paper
spacing: singlespacing
bibliography: paper.bib
---

# Summary

## Introduction

In this study we aimed to develop a scripted workflow to update geographical information system (GIS) regression mapping models that use land use and other predictors. 
GIS regression mapping was first introduced by @Briggs1997 and is a technique commonly used to create predictive spatial models (and spatiotemporal models) of pollutant levels. It is also known as land use regression (LUR), however, the label LUR does not reflect the fact that non-land use predictors are often used such as chemical transport models or remote sensing data (e.g. satellite aerosol optical depth). These models add more information than just land use data to the model as predictor variables. 
Such GIS regression mapping models are used extensively in epidemiological studies of health impacts of air pollution exposure [@Knibbs2014a; @DeHoogh2016; @Pereira2017; @Knibbs2018; @Dirgawati2019; @Cowie2019a].

## Purpose of the software

The updating of a GIS regression model can be conceptualised in five ways. These distinguish between updates that: 

1. create predictions at new locations, using the same regression equation and predictor data
1. predict at the same locations using data for new time periods but use the same regression equation
1. use data for new time periods to develop a new regression equation but keep the same set of candidate predictors
1. use new data and new equations developed with additional candidate predictor variables
1. create predictive models for a new pollutant using the same procedures.

The scripted workflow that we developed provides a set of software tools and a set of method steps that guide a user through the development of a GIS regression mapping model. Depending on the amount of data available models can be updated relatively quickly. In addition the updated models and data are 
well documented and reproducible. 

Primarily we focus on the type of updates that apply a previously developed 
model regression equation to 1) a new set of locations within the same study area and 2) a new time point. New locations can be defined by the user or can be based on a dataset containing regularly located points (i.e. a grid) or locations of the participants in a epidemiological study (i.e. exposure estimates). 
We aim to automate most of the process to reduce required efforts from the user. 

Our scripted workflow tools are aimed at GIS specialists and uses the PostGIS and R software environments which are technically sophisticated computing tools. These can be complicated to install and configure so we also provide an online cloud-based virtual desktop environment with these tools pre-configured so that users can develop the updates without having to install the tools on their local computers (https://cardat.github.io/).  All the software is published as free and open source software on Github (https://github.com/ivanhanigan/GIS_regression_mapping_scripted_workflow). Some of the data inputs require additional data provision agreements to be made between data owners and data users.

We developed a case study based on the methodology used by @Knibbs2014a. We also provide links to the protocols developed by the European Study of Cohorts for Air Pollution Effects (ESCAPE) [@Beelen:2013;@Eeftens:2012] as set out in the ESCAPE Exposure assessment manual [@escape]. Within air pollution research the ESCAPE methodology is used as the standard for developing GIS regression mapping models. 

## Current case study application

The scripted workflow has been developed through the Australian National Health and Medical Research Council (NHMRC) centre of research excellence Centre for Air pollution, energy and health Research (CAR).
CAR is a collaboration between more than 30 researchers from around Australia and internationally in diverse but related disciplines who are at the forefront of their scientific fields. The Centre is based in eight of Australia's most prestigious research institutions. 
The Centre provides an example of a current application for this scripted air pollution prediction models.

## Software implementation definitions

We used the PostgreSQL / PostGIS Geographical Information Systems (GIS) database server:

- PostgreSQL [www.postgresql.org](www.postgresql.org)
- PostGIS [http://postgis.refractions.net](http://postgis.refractions.net)

Workflow orchestration and statistical analysis was implemented in R:

- R language for statistical computing [www.r-project.org](www.r-project.org)
- and various R packages installed from the CRAN public repository

The "main.R" script in the project directory is set up so that the user can declare specific inputs required for the specific update, and then run the component steps in sequence. These are:

1. "01_test_connection_to_PostGIS.R"
2. "02_buffers.R"
3. "03_extract_OMI.R"
4. "04_overlay_IMPSA_with_1200M.R"
5. "05_majrds_intersect_with_500m_buffer.R"
6. "06_NPINOX_extract.R"
7. "07_industrial_or_open_in_buffer.R"     

We also include some helper functions written to enable user authentication on the database and database management:

1. "function_get_pgpass.R"
2. "function_pgListTables.R" 

## Data inputs

TODO. 

In the first case we should describe the data used for the Knibbs 2014 NO2 demo. Some of these are restricted access and we will need to discuss data provision agreements.

Second, we should describe how an extension case study would gather new data and insert into the database.

## Results

The resulting prediction datasets can be exported to a variety of GIS formats including ESRI Shapefiles and GeoTIFF raster files Figure \ref{fig:gisno2100m}. 


\begin{figure}[!h]
\centering
\includegraphics[width=.9\textwidth]{figures_and_tables/gis_no2_100m.png}
\caption{Western Sydney Liverpool case study 2016 NO2 predicted at a grid of evenly spaced points 100m by 100m and stored as a GeoTIFF file}
\label{fig:gisno2100m}
\end{figure}


In addition the codes are included to generate an interactive web mapping version as shown in Figure \ref{fig:gisno2leafletmapno2} and Figure \ref{fig:gisno2leafletmappop}.

\begin{figure}[!h]
\centering
\includegraphics[width=.8\textwidth]{figures_and_tables/gis_no2_leaflet_map_no2.png}
\caption{Western Sydney Liverpool case study NO2 in 2016 (ppb) averages for ABS Meshblocks from the 2016 Census}
\label{fig:gisno2leafletmapno2}
\end{figure}

\begin{figure}[!h]
\centering
\includegraphics[width=.8\textwidth]{figures_and_tables/gis_no2_leaflet_map_pop.png}
\caption{Western Sydney Liverpool case study 2016 populations for ABS Meshblocks}
\label{fig:gisno2leafletmappop}
\end{figure}

\clearpage

## Discussion and Conclusions

TODO

# Acknowledgments
This project was funded by the Clean Air and Urban Landscapes (CAUL) hub of the Australian Governmentâ€™s National and Environmental Science Programme (NESP).
Financial support was also provided by the Centre for Air pollution, energy and health Research (CAR, http://www.car-cre.org.au) an Australian National Health and Medical Research Council (NHMRC) Centre of Research Excellence; and the Air Pollution, Traffic Exposures and Mortality and Morbidity in Older Australians (APTEMA) Study.

This research is undertaken with the assistance of resources from the Collaborative Environment for Scholarly Analysis and Synthesis (CoESRA; https :// coesr a.tern.org.au).

\clearpage

# References
